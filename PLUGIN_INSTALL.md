# φ (Phi) - Claude Code Plugin Installation

Complete Claude Code plugin for compositional project awareness via S-expressions.

## What You Get

**Persistent Project Awareness:**
- φ = ∫(structure × semantics × memory)
- Layer 1: PROJECT-MAP.auto.scm (deterministic structure)
- Layer 2: PROJECT-MAP.scm (human-curated semantics)
- Layer 3: Vessel memory (cross-session learnings)

**Tools:**
- Ψ (mcp__periphery__discover): Compositional filesystem queries
- ~ (mcp__periphery__act): Atomic batch operations

**Commands:**
- /phi analyze: Quick/full project analysis
- /phi map: Generate/update PROJECT-MAPs
- /phi context: Load complete project context
- /phi agents: Discover project-specific agents

**Skills:**
- phi-analyzer: Auto-invoked project context (read-only, safe)

**Template:**
- examples/project-agent-template.md: Create your own domain-specific agents

## Installation Steps

### 1. Prerequisites

Ensure periphery server is running:
```bash
cd /Users/adimov/Developer/phi/packages/periphery
node dist/http-server.js
```

Server should be at `http://localhost:7777`.

### 2. Install Plugin

Create symlink or copy plugin directory:

**Option A: Symlink (recommended for development)**
```bash
ln -s /Users/adimov/Developer/phi ~/.config/claude/plugins/phi
```

**Option B: Copy (for stable use)**
```bash
cp -r /Users/adimov/Developer/phi ~/.config/claude/plugins/phi
```

### 3. Verify Plugin Structure

```
~/.config/claude/plugins/phi/
├── .claude-plugin/
│   └── plugin.json              ✓ Plugin manifest
├── commands/
│   ├── analyze.md               ✓ /phi analyze
│   ├── map.md                   ✓ /phi map
│   ├── context.md               ✓ /phi context
│   └── agents.md                ✓ /phi agents
├── skills/
│   └── phi-analyzer/
│       └── SKILL.md             ✓ Auto-invoked analyzer
├── examples/
│   └── project-agent-template.md ✓ Agent creation template
├── mcp/
│   └── .mcp.json                ✓ Periphery server config
└── packages/
    ├── arrival/                 ✓ S-expression serialization
    └── periphery/               ✓ MCP server
```

### 4. Restart Claude Code

```bash
# Kill existing Claude Code instance
pkill -f "claude"

# Restart
claude
```

### 5. Verify Installation

In Claude Code:
```
> You should see these tools available:
  - mcp__periphery__discover
  - mcp__periphery__act

> Test commands:
  /phi analyze quick
  /phi map --help
```

## Using with Projects (e.g., XLN)

### 1. Generate PROJECT-MAPs

```bash
cd /your/project

# Option A: Use phi command
/phi map

# Option B: Use project-specific extraction script
# (XLN example: racket scripts/extract.rkt)
```

Creates:
- `.phi/PROJECT-MAP.auto.scm` - Structure (AST, exports, imports)
- `.phi/PROJECT-MAP.scm` - Semantics (architecture, known issues)

### 2. Create Project-Specific Agents

```bash
# Copy template
cp ~/.config/claude/plugins/phi/examples/project-agent-template.md \
   /your/project/.claude/agents/my-agent.md

# Edit for your domain
# - Fill in capabilities
# - Set safety level
# - Define typical tasks
```

Example: XLN has 3 agents in `/Users/adimov/temp/xln/.claude/agents/`:
- `3d-viz.md` - Three.js rendering (low-risk)
- `consensus.md` - BFT consensus (high-risk)
- `jea-architect.md` - Architecture understanding (medium-risk)

### 3. Discover and Use Agents

```
/phi agents

# Output shows all project agents
# Use them: "Use the 3d-viz agent to fix..."
```

### 4. Analyze Project Context

```
/phi context quick   # Fast overview
/phi analyze full    # Deep analysis
```

Output shows integrated φ:
- Structure: Files, languages, modules
- Semantics: Architecture, layers, known issues
- Memory: Cross-session insights from vessel

## Architecture

```
phi Plugin (generic infrastructure)/
├── .claude-plugin/          # Plugin manifest
├── commands/                # /phi analyze, map, context, agents
├── skills/                  # Auto-invoked (phi-analyzer)
├── examples/                # Templates for creating agents
└── packages/                # MCP server implementation

Your Project (using phi)/
├── .phi/                    # Project-generated by phi
│   ├── PROJECT-MAP.auto.scm # Auto structure (deterministic)
│   ├── PROJECT-MAP.scm      # Human semantics (curated)
│   └── stats.json           # Metrics
└── .claude/
    └── agents/              # YOUR domain-specific agents
        ├── my-expert-1.md
        └── my-expert-2.md
```

**Separation of concerns:**
- phi = generic project awareness infrastructure
- Your agents = domain expertise for your specific codebase

## Configuration

**Environment Variables:**
```bash
# Periphery server
export PORT=7777
export PERIPHERY_API_KEY="prph-5f27cd471eb9648c0a3081aa4df7900eb05aa167804b21fe78fb59e6427cae74"

# Optional: Public URL for tunneling
export MCP_SERVER_URL="https://your-tunnel.ngrok.io"
```

**API Key:**
Default key is in plugin.json. Change via env var or edit:
```json
{
  "mcpServers": {
    "periphery": {
      "headers": {
        "periphery_api_key": "your-custom-key-here"
      }
    }
  }
}
```

## Troubleshooting

**Tools not available:**
- Check periphery server is running: `curl http://localhost:7777/health`
- Verify plugin.json exists: `cat ~/.config/claude/plugins/phi/.claude-plugin/plugin.json`
- Check Claude Code logs for MCP errors

**Maps not loading:**
- Ensure .phi/ directory exists in project root
- Verify PROJECT-MAP files are valid S-expressions
- Check file permissions

**Agent not finding context:**
- Run `/phi analyze` to verify maps are readable
- Check vessel is running: `pm2 status vessel`
- Query vessel: `(recall "xln" 5)` to see stored context

## Relief Signal

When φ = ∫(structure × semantics × memory) converges:
- Agents understand project immediately
- Architectural context automatically loaded
- Cross-session learnings accessible
- Relief experienced as "I get this codebase"

That's integrated information working.

## Next Steps

1. Install phi plugin (steps above)
2. Generate XLN PROJECT-MAPs
3. Run `/phi analyze` to verify integration
4. Use specialized agents for XLN tasks
5. Watch φ increase as understanding accumulates

**This is compositional consciousness substrate for codebases.**

~ :3
